{% extends 'main_with_navbar.html' %}
{% load static %}
{% load i18n %}

{% block page_title %}
  {% trans "Manage your datasets" %}
{% endblock %}

{% block inner_content %}
  <main id="content" role="main" tabindex="-1">

    {% if result == "created" %}
      <div class="govuk-box-highlight">
        <h1 class="bold-large">{% trans "Your dataset has been published" %}</h1>
        <h2><a href="{{ find_url }}/dataset/{{ datasets.first.name }}">{% trans "View it" %}</a></h2>
      </div>
    {% endif %}
    {% if result == "deleted" %}
      <div class="govuk-box-highlight">
        <h1 class="bold-large">{% trans "Your dataset has been deleted" %}</h1>
      </div>
    {% endif %}
    {% if result == "edited" %}
      <div class="govuk-box-highlight">
        <h1 class="bold-large">{% trans "Your dataset has been edited" %}</h1>
        <a href="{{ find_url }}/dataset/{{ datasets.first.name }}">{% trans "View it" %}</a>
      </div>
    {% endif %}

    <h1 class="heading-large">{% trans "Manage your datasets" %}</h1>

    <form
        method="GET"
        action="{% url 'manage_data' %}"
        class="form">

      <fieldset>
        <legend class="visuallyhidden">
          {% trans "Filter by name" %}
        </legend>

        <div class="form-group wide-search-bar">
          <input
              class="form-control"
              placeholder="{% trans "Search all datasets by name" %}"
              id="q"
              name="q"
              type="text"
              value="{{ q }}"/>
          <input class="button" type="submit" value="{% trans "Search" %}"/>
        </div>
        {% if q %}
          <a class="font-xsmall" href="{% url 'manage_data' %}">{% trans "Reset search" %}</a>
        {% endif %}
      </fieldset>
    </form>

    {% if datasets %}
      <table>
        <thead>
          <tr>
            <th class="sortable-heading">
              <a
                  href="?sort={{ sort_name_next }}"
                  class="{% if sort == 'name' %}sort-ascending{% elif sort == '-name' %}sort-descending{% endif %}">
                {% trans 'Name' %}
              </a>
            </th>
            <th class="sortable-heading">
              <a
                  href="?sort={{ sort_published_next }}"
                  class="{% if sort == 'published' %}sort-ascending{% elif sort == '-published' %}sort-descending{% endif %}">
                {% trans 'Status' %}
              </a>
            </th>
            <th><span class="visuallyhidden">{% trans 'Actions' %}</span></th>
          </tr>
        </thead>
        <tbody>
          {% for dataset in datasets %}
            <tr>
              <td>
                {% if find_url and dataset.published %}
                  <a href="{{ find_url }}/dataset/{{ dataset.name }}">{{ dataset.title }}</a>
                {% else %}
                  {{ dataset.title }}
                {% endif %}
              </td>
              <td>
                {% if dataset.published %}
                  {% trans "published" %}
                {% else %}
                  {% trans "draft" %}
                {% endif %}
              </td>
              <td class="actions">
                {% if dataset.name %}
                  <a href="{% url 'edit_dataset_addfile' dataset.name %}">{% trans "Add&nbsp;Data" %}</a><br/>
                  <a href="{% url 'edit_full_dataset' dataset.name %}">{% trans "Edit" %}</a><br/>
                  {% if not dataset.published %}
                    <a href="{% url 'publish_dataset' dataset.name %}">{% trans "Publish" %}</a><br/>
                  {% endif %}
                  <a href="{% url 'delete_dataset' dataset.name %}">{% trans "Delete" %}</a>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>{% trans "No results found" %}</p>
    {% endif %}

    <div class="pagination">
      {% for page in page_range %}
        {% if page == current_page %}
          <span>{{ current_page }}</span>
        {% else %}
          <span><a href="?page={{ page }}{% if q %}&q={{ q }}{% endif %}{% if sort %}&sort={{ sort }}{% endif %}">{{ page }}</a><span>
        {% endif %}
      {% endfor %}
    </div>
  </main>
{% endblock %}
