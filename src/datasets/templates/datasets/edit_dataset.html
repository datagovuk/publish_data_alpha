{% extends 'main_with_navbar.html' %}
{% load static %}
{% load flow_state %}

{% block page_title %}
  Edit dataset
{% endblock %}

{% block inner_content %}

  {% include 'datasets/includes/error_box.html' %}

  <h1 class="heading-large">
    Edit ‘{{ dataset.title }}’
  </h1>

  <form action="{% url 'edit_full_dataset' dataset.name %}" method="POST">
    {% csrf_token %}

    <!-- TITLE / SUMMARY / DESCRIPTION -->

    <fieldset>
      <legend class="visuallyhidden">
        Provide a title, summary, and description.
      </legend>
      <div
          class="form-group {% if form.title.errors %}error{% endif %}"
          id="title_form_group">
        <label
            class="form-label-bold"
            for="id_title">
          Title
        </label>
        {% for error in form.title.errors %}
          <span class="error-message">{{ error }}</span>
        {% endfor %}
        <input
            class="form-control form-control-2-3"
            id="id_title"
            name="{{ form.title.html_name }}"
            type="text"
            value="{{ form.title.value|default:"" }}"/>
      </div>
      <div
          class="form-group {% if form.summary.errors %}error{% endif %}"
          id="summary_form_group">
        <label
            class="form-label-bold"
            for="id_summary">
          Summary
        </label>
        {% for error in form.summary.errors %}
          <span class="error-message">{{ error }}</span>
        {% endfor %}
        <textarea
            rows="4"
            class="form-control form-control-2-3"
            id="id_summary"
            name="{{ form.summary.html_name }}">{{ form.summary.value|default:""}}</textarea>
      </div>
      <div
          class="form-group {% if form.description.errors %}error{% endif %}"
          id="description_form_group">
        <label
            class="form-label-bold"
            for="id_description">
          Additional information
        </label>
        {% for error in form.description.errors %}
          <span class="error-message">{{ error }}</span>
        {% endfor %}
        <textarea
            rows="10"
            class="form-control form-control-2-3"
            id="id_description"
            name="{{ form.description.html_name }}">{{ form.description.value|default:""}}</textarea>
      </div>
    </fieldset>

    <!-- LINKS -->

    <h2 class="heading-small">Links</h2>

    <table>
      <thead class="visuallyhidden">
        <tr>
          <th>Title</th>
          <th>Url</th>
          <th>Valid</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for file in dataset.files.all %}
          {% if not file.is_documentation %}
            <tr>
              <td>{{ file.title }}</td>
              <td>{{ file.url }}</td>
              <td>valid</td>
            </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>

    <a href="{% url 'edit_dataset_files' dataset.name %}">
      Change
    </a>

    <!-- DOCUMENTS -->

    <h2 class="heading-small">Documents</h2>

    <table>
      <thead class="visuallyhidden">
        <tr>
          <th>Title</th>
          <th>Url</th>
          <th>Valid</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for file in dataset.files.all %}
          {% if file.is_documentation %}
            <tr>
              <td>{{ file.title }}</td>
              <td>{{ file.url }}</td>
              <td>valid</td>
            </tr>
          {% endif %}
        {% endfor %}
      </tbody>
    </table>

    <a href="{% url 'edit_dataset_documents' dataset.name %}">
      Change
    </a>

    <!-- LOCATION -->

    <h2 class="heading-small">Areas covered</h2>

    <div
        class="form-group {% if form.location1.errors or form.location2.errors or form.location3.errors %}error{% endif %}"
        id="location_form_group">
      <fieldset>
        <legend class="visually-hidden">Location</legend>
        {% if form.location1.errors or form.location2.errors or form.location3.errors %}
        <span class="error-message">
          Please enter the area that your dataset covers
        </span>
        {% endif %}

        <div id="location1">
          <label class="bold" for="id_location1">
            <span>Area</span>
          </label>
          <a id="del1"
             class="secondary-button"
             style="display: none"
             aria-hidden="true">Remove</a>
          <input
              class="location-input form-control form-control-2-3"
              id="id_location1"
              name="{{ form.location1.html_name }}"
              type="text"
              autocomplete="off"
              value="{{ form.location1.value|default:'' }}" />
        </div>
        <p>
          <a
              id="add1"
              class="secondary-button"
              style="display: none"
              aria-hidden="true">
            Add another area
          </a>
        </p>

        <div id="location2">
          <label class="bold" for="id_location2">
            <span>Area</span>
          </label>
          <a
              id="del2"
              class="secondary-button"
              style="display: none"
              aria-hidden="true">Remove</a>
          <input
              class="location-input form-control form-control-2-3"
              id="id_location2"
              name="{{ form.location2.html_name }}"
              type="text"
              autocomplete="off"
              value="{{ form.location2.value|default:'' }}" />
        </div>
        <p>
          <a
              id="add2"
              class="secondary-button"
              style="display: none"
              aria-hidden="true">
            Add another area
          </a>
        </p>

        <div id="location3">
          <label class="bold" for="id_location3">
            <span>Area</span>
          </label>
          <a
              id="del3"
              class="secondary-button"
              style="display: none"
              aria-hidden="true">Remove</a>
          <input
              class="location-input form-control form-control-2-3"
              id="id_location3"
              name="{{ form.location3.html_name }}"
              type="text"
              autocomplete="off"
              value="{{ form.location3.value|default:'' }}" />
        </div>
      </fieldset>
    </div>

    <!-- LICENCE -->

    <div
        class="form-group {% if form.licence.errors %}error{% endif %}"
        id="licence_form_group">
      <fieldset>
        <legend class="heading-small">Licence</legend>
        {% for error in form.licence.errors %}
          <span class="error-message">{{ error }}</span>
        {% endfor %}
        <label class="block-label selection-button-radio" for="id_licence_0">
          <input
              id="id_licence_0"
              name="{{ form.licence.html_name }}"
              type="radio"
              value="uk-ogl"
              {% if form.licence.value == 'uk-ogl' %}checked{% endif %} />
          <span>Open Government Licence</span>
        </label>
        <label
            class="block-label selection-button-radio"
            for="id_licence_2"
            data-target="other-licence">
          <input
              id="id_licence_2"
              name="{{ form.licence.html_name }}"
              type="radio"
              value="other"
              {% if form.licence.value == 'other' %}checked{% endif %}  />
          <span>Other:</span>
        </label>
        <div class="panel panel-border-narrow js-hidden" id="other-licence">
          <label
              class="form-label"
              for="id_licence_other">Name of your licence:</label>
          <input
              class="form-control"
              id="id_licence_other"
              name="{{ form.licence_other.html_name }}"
              value="{{ form.licence_other.value }}"
              type="text">
        </div>
      </fieldset>
    </div>

    <!-- ORGANISATION -->

    <div
        class="form-group {% if form.organisation.errors %}error{% endif %}"
        id="organisation_form_group">
      <fieldset>
        <legend class="heading-small">Organisation</legend>
        {% if form.organisation.errors %}
        <span class="error-message">
          Please choose which organisation will own this dataset
        </span>
        {% endif %}
        {% for organisation in organisations %}
        <label
            class="block-label selection-button-radio"
            for="id_organisation_{{ forloop.counter }}">
          <input
              id="id_organisation_{{ forloop.counter }}"
              name="{{ form.organisation.html_name }}"
              type="radio"
              value="{{ organisation.id }}"
              {% if form.organisation.value == organisation.id %}
                checked
              {% endif %}/>
          <span>{{ organisation.title }}</span>
        </label>
        {% endfor %}
      </fieldset>
    </div>

    <!-- FREQUENCY -->

    <div
        class="form-group {% if form.frequency.errors %}error{% endif %}"
        id="#frequency_form_group">
      <fieldset>
        <legend class="heading-small">Updates</legend>
        {% if form.frequency.errors %}
        <span class="error-message">
          Please indicate how often this dataset is updated
        </span>
        {% endif %}
        <label class="block-label selection-button-radio" for="id_frequency_0">
          <input
              id="id_frequency_0"
              name="{{ form.frequency.html_name }}"
              type="radio"
              value="daily"
              {% if form.frequency.value == 'daily' %}
                checked
              {% endif %}/>
          <span>Every day</span>
        </label>
        <label class="block-label selection-button-radio" for="id_frequency_1">
          <input
              id="id_frequency_1"
              name="{{ form.frequency.html_name }}"
              type="radio"
              value="weekly"
              {% if form.frequency.value == 'weekly' %}
                checked
              {% endif %}/>
          <span>Every week</span>
        </label>
        <label class="block-label selection-button-radio" for="id_frequency_2">
          <input
              id="id_frequency_2"
              name="{{ form.frequency.html_name }}"
              type="radio"
              value="monthly"
              {% if form.frequency.value == 'monthly' %}
                checked
              {% endif %}/>
          <span>Every month</span>
        </label>
        <label class="block-label selection-button-radio" for="id_frequency_3">
          <input
              id="id_frequency_3"
              name="{{ form.frequency.html_name }}"
              type="radio"
              value="quarterly"
              {% if form.frequency.value == 'quarterly' %}
              checked
              {% endif %} />
          <span>Every quarter</span>
        </label>
        <label class="block-label selection-button-radio" for="id_frequency_4">
          <input
              id="id_frequency_4"
              name="{{ form.frequency.html_name }}"
              type="radio"
              value="annually"
              {% if form.frequency.value == 'annually' %}
                checked
              {% endif %} />
          <span>Every year (January to December)</span>
        </label>
        <label class="block-label selection-button-radio" for="id_frequency_5">
          <input
              id="id_frequency_5"
              name="{{ form.frequency.html_name }}"
              type="radio"
              value="financial-year"
              {% if form.frequency.value == 'financial-year' %}
                checked
              {% endif %} />
          <span>Every year (April to March)</span>
        </label>
        <label class="block-label selection-button-radio" for="id_frequency_6">
          <input
              id="id_frequency_6"
              name="{{ form.frequency.html_name }}"
              type="radio"
              value="never"
              {% if form.frequency.value == 'never' %}
                checked
              {% endif %} />
          <span>Never</span>
        </label>
      </fieldset>
    </div>

    <!-- NOTIFICATIONS -->
    {% if form.notifications.value %}
      <div
          id="notifications_form_group"
          class="form-group {% if form.notifications.errors %}error{% endif %}">
        <fieldset>
          <legend class="heading-small">Update notification</legend>
          {% for error in form.notifications.errors %}
            <span class="error-message">{{ error }}</span>
          {% endfor %}
          <label
              class="block-label selection-button-radio"
              for="id_notifications_0">
            <input
                id="id_notifications_0"
                name="{{ form.notifications.html_name }}"
                type="radio"
                value="yes"
                {% if form.notifications.value == "yes" %}
                  checked
                {% endif %} />
            <span>Yes</span>
          </label>
          <label
              class="block-label selection-button-radio"
              for="id_notifications_1">
            <input
                id="id_notifications_1"
                name="{{ form.notifications.html_name }}"
                type="radio"
                value="no"
                {% if form.notifications.value == "no" %}
                  checked
                {% endif %} />
            <span>No</span>
          </label>
        </fieldset>
      </div>
    {% endif %}
    <div class="form-group">
      <input type="submit" class="button" value="Save"/>
      <a href="{% url 'delete_dataset' dataset.name %}" class="secondary-button">
        Delete this dataset
      </a>
    </div>
  </form>
{% endblock %}
